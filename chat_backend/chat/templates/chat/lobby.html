
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Lobby</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    {% load static %}
    <link rel="stylesheet" href="{% static 'lobby.css'%}">

</head>
<body>
    <section class="welcome">

        {% if request.user.is_authenticated %}
        <p>Welcome, {{request.user}}</p>
        {% endif %}
        <a href="{% url 'home' %}" class="btn btn-dark btn-block btn-sm m-1">Home</a>
    </section>
    
        <ul>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">A</div>
            </li>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">L</div>
            </li>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">L</div>
            </li>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">C</div>
            </li>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">H</div>
            </li>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">A</div>
            </li>
            <li>
            <input type="checkbox" />
            <div classname="animation-text">T</div>
            </li>
        </ul>


 

    <section class="chat-box">
        <form id="form">
            <input type="text" name="message" placeholder="Enter Message Here..."/>
        </form>
        <section id="messages"></section>
    </section>


    <script type="text/javascript">
        let url = `ws://${window.location.host}/ws/socket-server/`

        const chatSocket = new WebSocket(url)

        chatSocket.onmessage = function(e){
            let data = JSON.parse(e.data)
            console.log('Data:', data)

            if(data.type === 'chat'){
                let messages = document.getElementById('messages')
                console.log(messages)


                messages.insertAdjacentHTML('beforeend', `<section class="messages-in-box">
                                        <p><form method="delete">
                                            &nbsp;
                <button formmethod="delete"type="submit" value="${messages}">X</button>&nbsp;<p class="user-in-message">${data.username}</p>: ${data.message}</p>
                                    
                                    </section>
                                    
            </form>`)
            }
        }

        let form = document.getElementById('form')
        form.addEventListener('submit', (e)=> {
            e.preventDefault()
            let message = e.target.message.value 
            chatSocket.send(JSON.stringify({
                'message':message
            }))
            form.reset()
        })

    </script>
</body>
</html>